import{o as t,c as i,w as e,n,a as r,x as o,C as s,E as a,i as h,O as _,d as l,r as c,e as u,u as p,b as f,q as g}from"./index-c6e72d6b.js";import{_ as y}from"./plugin-vueexport-helper.1b428a4d.js";
/*!
* RawCanvas of VISLite JavaScript Library v1.4.0
* git+https://github.com/oi-contrib/VISLite.git
*/var d=function(t,i){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(t,i)},v=function(){return v=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var r in i=arguments[e])Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r]);return t},v.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var w=function(t,i,e,n,r){var o=Math.cos(e),s=Math.sin(e);return[+((n-t)*o-(r-i)*s+t).toFixed(7),+((n-t)*s+(r-i)*o+i).toFixed(7)]},P=function(t,i,e,n,r){return t.beginPath(),t.translate(e,n),t.rotate(r),t.font=i.fontStyle+" "+i.fontWeight+" "+i.fontSize+"px "+i.fontFamily,t},C=function(t,i,e,n,r,o,s,a){if(r>o){var h=r;r=o,o=h}return s%=2*Math.PI,a>=1.999999*Math.PI||a<=1.999999*-Math.PI?a=2*Math.PI:a%=2*Math.PI,function(s,a,h,_,l,c,u){a<0&&(s+=a,a*=-1);var p,f=[];p=w(0,0,s,l,0),f[0]=p[0],f[1]=p[1],p=w(0,0,a,p[0],p[1]),f[2]=p[0],f[3]=p[1],p=w(0,0,s,c,0),f[4]=p[0],f[5]=p[1],p=w(0,0,a,p[0],p[1]),f[6]=p[0],f[7]=p[1],function(s,a,h,_,l,c,u,p,f,g,y){y<0&&(y=-y),t.beginPath(),t.moveTo(h,_),t.arc(e,n,r,s,a,!1),"round"==i.arcEndCap?t.arc(.5*(u+f),.5*(p+g),y,a-Math.PI,a,!0):"-round"==i.arcEndCap?t.arc(.5*(u+f),.5*(p+g),y,a-Math.PI,a,!1):t.lineTo(f,g),t.arc(e,n,o,a,s,!0),"round"==i.arcStartCap?t.arc(.5*(h+l),.5*(_+c),y,s,s-Math.PI,!0):"-round"==i.arcStartCap?t.arc(.5*(h+l),.5*(_+c),y,s,s-Math.PI,!1):t.lineTo(h,_)}(s,s+a,f[0]+h,f[1]+_,f[4]+h,f[5]+_,f[2]+h,f[3]+_,f[6]+h,f[7]+_,.5*(c-l))}(s,a,e,n,r,o),"butt"==i.arcStartCap&&t.closePath(),t},x=function(t,i,e,n){return t.beginPath(),t.moveTo(i+n,e),t.arc(i,e,n,0,2*Math.PI),t},m=function(t,i,e,n,r,o){t.beginPath();var s=[];if(Array.isArray(i.rectRadius)&&i.rectRadius.length>0)for(var a=0;a<4;a++)s.push.apply(s,i.rectRadius);return s.length>=4?(t.arc(e+s[0],n+s[0],s[0],Math.PI,1.5*Math.PI),t.arc(e+r-s[1],n+s[1],s[1],1.5*Math.PI,0),t.arc(e+r-s[2],n+o-s[2],s[2],0,.5*Math.PI),t.arc(e+s[3],n+o-s[3],s[3],.5*Math.PI,Math.PI),t.closePath()):t.rect(e,n,r,o),t};function R(t,i,e,n,r){for(var o=0,s="",a=0;a<i.length;a++)t.measureText(s+i[a]).width>e||/\n$/.test(s)?(r(s,((o+=1)-.5)*n),s=i[a]):a==i.length-1?(o+=1,r(s+i[a],(o-.5)*n)):s+=i[a];return o*n}function T(t){var i={fontSize:16,fontFamily:"sans-serif",fontWeight:400,fontStyle:"normal",arcStartCap:"butt",arcEndCap:"butt",rectRadius:[]},e={fillStyle:"black",strokeStyle:"black",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],textAlign:"left",textBaseline:"middle",shadowBlur:0,shadowColor:"black"};return"special"==t?i:"init"==t?e:v(v({},i),e)}var b=function(){function t(t,i,e,n,r){void 0===i&&(i={}),void 0===n&&(n=!1),this.__region=null,this.__onlyRegion=!1,this.__onlyView=!1,this.__specialConfig=T("special"),this.__initConfig=T("init"),this.painter=t.getContext("2d",i),this.__region=e,this.__isPainter=n,this.painter.textBaseline="middle",this.painter.textAlign="left"}return t.prototype.useConfig=function(t,i){if(this.__region&&!this.__onlyView&&["fillStyle","strokeStyle","shadowBlur","shadowColor"].indexOf(t)<0&&this.__region.useConfig(t,i),this.__isPainter&&this.__onlyRegion)return this;if("lineDash"==t)this.painter.setLineDash&&this.painter.setLineDash(i);else if(t in this.__specialConfig)"fontSize"==t&&(i=Math.round(i)),this.__specialConfig[t]=i;else{if(!(t in this.__initConfig))throw new Error("Illegal configuration item of painter : "+t+" !");this.painter[t]=i}return this},t.prototype.fillText=function(t,i,e,n){return void 0===n&&(n=0),this.__region&&!this.__onlyView&&this.__region.fillText(t,i,e,n),this.__isPainter&&this.__onlyRegion||(this.painter.save(),P(this.painter,this.__specialConfig,i,e,n).fillText(t,0,0),this.painter.restore()),this},t.prototype.strokeText=function(t,i,e,n){return void 0===n&&(n=0),this.__region&&!this.__onlyView&&this.__region.strokeText(t,i,e,n),this.__isPainter&&this.__onlyRegion||(this.painter.save(),P(this.painter,this.__specialConfig,i,e,n).strokeText(t,0,0),this.painter.restore()),this},t.prototype.fullText=function(t,i,e,n){return void 0===n&&(n=0),this.__region&&!this.__onlyView&&this.__region.fullText(t,i,e,n),this.__isPainter&&this.__onlyRegion||(this.painter.save(),P(this.painter,this.__specialConfig,i,e,n),this.painter.fillText(t,0,0),this.painter.strokeText(t,0,0),this.painter.restore()),this},t.prototype.fillTexts=function(t,i,e,n,r,o){var s=this;void 0===r&&(r=1.2),void 0===o&&(o=0);var a=0;if(this.__region&&!this.__onlyView&&(a=this.__region.fillTexts(t,i,e,n,r)),this.__isPainter&&this.__onlyRegion)return a;this.painter.save(),P(this.painter,this.__specialConfig,i,e,o);var h=R(this.painter,t,n,this.__specialConfig.fontSize*r,(function(t,i){s.painter.fillText(t,0,i)}));return this.painter.restore(),h},t.prototype.strokeTexts=function(t,i,e,n,r,o){var s=this;void 0===r&&(r=1.2),void 0===o&&(o=0);var a=0;if(this.__region&&!this.__onlyView&&(a=this.__region.fillTexts(t,i,e,n,r)),this.__isPainter&&this.__onlyRegion)return a;this.painter.save(),P(this.painter,this.__specialConfig,i,e,o);var h=R(this.painter,t,n,this.__specialConfig.fontSize*r,(function(t,i){s.painter.strokeText(t,0,i)}));return this.painter.restore(),h},t.prototype.fullTexts=function(t,i,e,n,r,o){var s=this;void 0===r&&(r=1.2),void 0===o&&(o=0);var a=0;if(this.__region&&!this.__onlyView&&(a=this.__region.fillTexts(t,i,e,n,r)),this.__isPainter&&this.__onlyRegion)return a;this.painter.save(),P(this.painter,this.__specialConfig,i,e,o);var h=R(this.painter,t,n,this.__specialConfig.fontSize*r,(function(t,i){s.painter.fillText(t,0,i),s.painter.strokeText(t,0,i)}));return this.painter.restore(),h},t.prototype.beginPath=function(){return this.__region&&!this.__onlyView&&this.__region.beginPath(),this.__isPainter&&this.__onlyRegion||this.painter.beginPath(),this},t.prototype.closePath=function(){return this.__region&&!this.__onlyView&&this.__region.closePath(),this.__isPainter&&this.__onlyRegion||this.painter.closePath(),this},t.prototype.moveTo=function(t,i){return this.__region&&!this.__onlyView&&this.__region.moveTo(t,i),this.__isPainter&&this.__onlyRegion||this.painter.moveTo(Math.round(t)+.5,Math.round(i)+.5),this},t.prototype.lineTo=function(t,i){return this.__region&&!this.__onlyView&&this.__region.lineTo(t,i),this.__isPainter&&this.__onlyRegion||this.painter.lineTo(Math.round(t)+.5,Math.round(i)+.5),this},t.prototype.arc=function(t,i,e,n,r){return this.__region&&!this.__onlyView&&this.__region.arc(t,i,e,n,r),this.__isPainter&&this.__onlyRegion||this.painter.arc(t,i,e,n,n+r,r<0),this},t.prototype.fill=function(){return this.__region&&!this.__onlyView&&this.__region.fill(),this.__isPainter&&this.__onlyRegion||this.painter.fill(),this},t.prototype.stroke=function(){return this.__region&&!this.__onlyView&&this.__region.stroke(),this.__isPainter&&this.__onlyRegion||this.painter.stroke(),this},t.prototype.full=function(){return this.__region&&!this.__onlyView&&this.__region.full(),this.__isPainter&&this.__onlyRegion||(this.painter.fill(),this.painter.stroke()),this},t.prototype.save=function(){return this.__region&&!this.__onlyView&&this.__region.save(),this.__isPainter&&this.__onlyRegion||this.painter.save(),this},t.prototype.restore=function(){return this.__region&&!this.__onlyView&&this.__region.restore(),this.__isPainter&&this.__onlyRegion||this.painter.restore(),this},t.prototype.clip=function(){return this.__region&&!this.__onlyView&&this.__region.clip(),this.__isPainter&&this.__onlyRegion||this.painter.clip(),this},t.prototype.quadraticCurveTo=function(t,i,e,n){return this.__region&&!this.__onlyView&&this.__region.quadraticCurveTo(t,i,e,n),this.__isPainter&&this.__onlyRegion||this.painter.quadraticCurveTo(t,i,e,n),this},t.prototype.bezierCurveTo=function(t,i,e,n,r,o){return this.__region&&!this.__onlyView&&this.__region.bezierCurveTo(t,i,e,n,r,o),this.__isPainter&&this.__onlyRegion||this.painter.bezierCurveTo(t,i,e,n,r,o),this},t.prototype.clearRect=function(t,i,e,n){return this.__region&&!this.__onlyView&&this.__region.clearRect(t,i,e,n),this.__isPainter&&this.__onlyRegion||this.painter.clearRect(t,i,e,n),this},t.prototype.clearCircle=function(t,i,e){return this.__region&&!this.__onlyView&&this.__region.clearCircle(t,i,e),this.__isPainter&&this.__onlyRegion||(this.painter.beginPath(),this.painter.globalCompositeOperation="destination-out",this.painter.arc(t,i,e,0,2*Math.PI),this.painter.fill(),this.painter.globalCompositeOperation="source-over",this.painter.closePath()),this},t.prototype.fillArc=function(t,i,e,n,r,o){return this.__region&&!this.__onlyView&&this.__region.fillArc(t,i,e,n,r,o),this.__isPainter&&this.__onlyRegion||C(this.painter,this.__specialConfig,t,i,e,n,r,o).fill(),this},t.prototype.strokeArc=function(t,i,e,n,r,o){return this.__region&&!this.__onlyView&&this.__region.strokeArc(t,i,e,n,r,o),this.__isPainter&&this.__onlyRegion||C(this.painter,this.__specialConfig,t,i,e,n,r,o).stroke(),this},t.prototype.fullArc=function(t,i,e,n,r,o){return this.__region&&!this.__onlyView&&this.__region.fullArc(t,i,e,n,r,o),this.__isPainter&&this.__onlyRegion||(C(this.painter,this.__specialConfig,t,i,e,n,r,o),this.painter.fill(),this.painter.stroke()),this},t.prototype.fillCircle=function(t,i,e){return this.__region&&!this.__onlyView&&this.__region.fillCircle(t,i,e),this.__isPainter&&this.__onlyRegion||x(this.painter,t,i,e).fill(),this},t.prototype.strokeCircle=function(t,i,e){return this.__region&&!this.__onlyView&&this.__region.strokeCircle(t,i,e),this.__isPainter&&this.__onlyRegion||x(this.painter,t,i,e).stroke(),this},t.prototype.fullCircle=function(t,i,e){return this.__region&&!this.__onlyView&&this.__region.fullCircle(t,i,e),this.__isPainter&&this.__onlyRegion||(x(this.painter,t,i,e),this.painter.fill(),this.painter.stroke()),this},t.prototype.fillRect=function(t,i,e,n){return this.__region&&!this.__onlyView&&this.__region.fillRect(t,i,e,n),this.__isPainter&&this.__onlyRegion||m(this.painter,this.__specialConfig,t,i,e,n).fill(),this},t.prototype.strokeRect=function(t,i,e,n){return this.__region&&!this.__onlyView&&this.__region.strokeRect(t,i,e,n),this.__isPainter&&this.__onlyRegion||m(this.painter,this.__specialConfig,t,i,e,n).stroke(),this},t.prototype.fullRect=function(t,i,e,n){return this.__region&&!this.__onlyView&&this.__region.fullRect(t,i,e,n),this.__isPainter&&this.__onlyRegion||(m(this.painter,this.__specialConfig,t,i,e,n),this.painter.fill(),this.painter.stroke()),this},t.prototype.draw=function(){return Promise.resolve()},t.prototype.drawImage=function(t,i,e,n,r,o){var s=this;return void 0===o&&(o=!1),new Promise((function(a){if(s.__region&&!s.__onlyView&&s.__region.fillRect(i,e,n,r),s.__isPainter&&s.__onlyRegion)a({});else if("string"!=typeof t||o)s.painter.drawImage(t,i,e,n,r),a({});else{var h=new Image;h.onload=function(){s.painter.drawImage(h,i,e,n,r),a({})},h.src=t}}))},t.prototype.install=function(t){var i=this,e=function(e){if(e in n)throw new Error("VISLite Canvas:Method already exists and cannot be overwritten.");n[e]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=t[e].apply(i,n);return null!=o?o:i}},n=this;for(var r in t)e(r);return this},t}(),k=function(t,i){var e={value:function(){return t},setColor:function(n,r){return t.addColorStop(i?i(n):n,r),e}};return e},I=function(t){function i(i,e,n,r){void 0===n&&(n={}),void 0===r&&(r=1);var o=t.call(this,i,n,e?new b(e,{willReadFrequently:!0}):void 0,!0,r)||this;return o.name="Canvas",o.__regionList={},o.__regionAssemble=function(t,i,e,n){for(var r=[],o=0;o<3;o++)r[o]=0;return function(){for(var t=0;t<3;t++){if(r[t]+10<255){r[t]=+(r[t]+10).toFixed(7);break}t<2&&(r[t]=0)}return r}}(),o.__scaleSize=r,o.setRegion(""),o}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=t}d(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}(i,t),i.prototype.config=function(t){for(var i in t)this.useConfig(i,t[i]);return this},i.prototype.reset=function(){return this.config(T()),this},i.prototype.onlyRegion=function(t){return this.__onlyRegion=t,this},i.prototype.onlyView=function(t){return this.__onlyView=t,this},i.prototype.setRegion=function(t){if(this.__region)if(t){if(null==this.__regionList[t]){var i=this.__regionAssemble();this.__regionList[t]="rgb("+i[0]+","+i[1]+","+i[2]+")"}this.__region.useConfig("fillStyle",this.__regionList[t])&&this.__region.useConfig("strokeStyle",this.__regionList[t])}else this.__region.useConfig("fillStyle","#000000")&&this.__region.useConfig("strokeStyle","#000000");return this},i.prototype.getRegion=function(t,i){var e=this;return new Promise((function(n){var r=e.__region?e.__region.painter.getImageData(t-.5,i-.5,1,1):{data:[0,0,0,0]},o=r.data,s=function(){if(e.__region)for(var t in e.__regionList)if("rgb("+o[0]+","+o[1]+","+o[2]+")"==e.__regionList[t]){n(t);break}n("")};o?s():r.then((function(t){o=t,s()}))}))},i.prototype.textWidth=function(t){this.painter.save(),P(this.painter,this.__specialConfig,0,0,0);var i=this.painter.measureText(t+"").width;return this.painter.restore(),i},i.prototype.getContext=function(t){return void 0===t&&(t=!1),t?this.__region?this.__region.painter:null:this.painter},i.prototype.getInfo=function(){return{width:this.painter.canvas.width/this.__scaleSize,height:this.painter.canvas.height/this.__scaleSize}},i.prototype.createLinearGradient=function(t,i,e,n){return r=this.painter,o=t,s=i,a=e,h=n,_=r.createLinearGradient(o,s,a,h),k(_);var r,o,s,a,h,_},i.prototype.createRadialGradient=function(t,i,e){return n=this.painter,r=t,o=i,s=e,a=n.createRadialGradient(r,o,0,r,o,s),k(a);var n,r,o,s,a},i.prototype.createConicGradient=function(t,i,e,n){return r=this.painter,o=t,s=i,a=e,h=n,_=r.createConicGradient(a,o,s),k(_,h?function(t){return h/(2*Math.PI)*t}:void 0);var r,o,s,a,h,_},i.prototype.getColor=function(t,i){t*=this.__scaleSize,i*=this.__scaleSize;var e=this.painter.getImageData(t-.5,i-.5,1,1).data;return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},i}(b);const V=y({data:()=>({uniqueid:(1e4*Math.random()).toFixed(0),help:{},viewImg:"",isH5:!0,hadFetch:!1}),props:{width:{type:Number,default:300},height:{type:Number,default:150},cover:{type:Boolean,default:!0},region:{type:Boolean,default:!0}},methods:{fetch(){let t,i,e,n;t=uni.createCanvasContext("painter-"+this.uniqueid,this),this.region&&(i=uni.createCanvasContext("region-"+this.uniqueid,this)),e="painter-"+this.uniqueid,n="region-"+this.uniqueid;let r=this;return this.help.instance=new I({getContext:()=>t},r.region?{getContext:()=>(i.getImageData=(t,i,e,o)=>new Promise(((s,a)=>{let h={x:t,y:i,width:e,height:o,canvasId:n,success:function(t){s(t.data)},fail:function(t){a(t)}};uni.canvasGetImageData(h,r)})),i)}:null,1),this.help.instance.draw=(n=!1,o=(()=>{}))=>{t.draw(n,(()=>{this.cover||this.isH5?(r.region&&i.draw(n),o()):uni.canvasToTempFilePath({canvasId:e,success:t=>{this.viewImg=t.tempFilePath,r.region&&i.draw(n),o()}},this)}))},this.hadFetch=!0,new Promise(((t,i)=>{this.help.instance.toDataURL=()=>new Promise((t=>{uni.canvasToTempFilePath({canvasId:e,success:function(i){t(i.tempFilePath)}},this)})),this.help.instance.drawImage=function(t,i){return function(e,n,r,o,s){return new Promise((a=>{/^http/.test(e)?uni.downloadFile({url:e,success:function(e){i.call(t,e.tempFilePath,n,r,o,s,!0).then((()=>{a({})}))}}):i.call(t,e,n,r,o,s,!0).then((()=>{a({})}))}))}}(this.help.instance,this.help.instance.drawImage),t(this.help.instance)}))},doit(t){let i=(t,i)=>{this.help.instance.getRegion(t,i).then((e=>{this.$emit("dotouchstart",{name:e,x:t,y:i})}))};if(this.cover||this.isH5){let e=t.touches[0].x,n=t.touches[0].y;i(e,n)}else uni.createSelectorQuery().selectViewport().scrollOffset().exec((e=>{uni.createSelectorQuery().in(this).select(".view-"+this.uniqueid).boundingClientRect((n=>{i(t.touches[0].pageX-n.left-e[0].scrollLeft,t.touches[0].pageY-n.top-e[0].scrollTop)})).exec()}))},doitstart(t){this.doit(t)}}},[["render",function(l,c,u,p,f,g){const y=a,d=h,v=_;return t(),i(d,{class:n(u.cover||f.isH5?"cover-view":"normal-view"),style:{display:"inline-block"}},{default:e((()=>[u.cover||f.isH5?s("",!0):(t(),i(d,{key:0,class:n("view-img view-"+f.uniqueid),onTouchstart:g.doitstart},{default:e((()=>[r(y,{style:o({width:u.width+"px",height:u.height+"px"}),src:f.viewImg},null,8,["style","src"])])),_:1},8,["class","onTouchstart"])),r(v,{class:"painter","canvas-id":"painter-"+f.uniqueid,onTouchstart:g.doitstart,style:o([{width:u.width+"px",height:u.height+"px"},u.cover||f.isH5?{}:{position:"fixed",left:"50000px"}])},null,8,["canvas-id","onTouchstart","style"]),u.region?(t(),i(v,{key:1,class:"region","canvas-id":"region-"+f.uniqueid,style:o({width:u.width+"px",height:u.height+"px",position:"fixed",left:"50000px"})},null,8,["canvas-id","style"])):s("",!0)])),_:1},8,["class"])}]]),S=y(l({__name:"index",setup(n){let o,s=uni.upx2px(500),a=uni.upx2px(500),_=c();u((()=>{_.value.fetch().then((t=>{t.fillCircle(.5*s,.5*s,.5*s).draw(),o=t}))}));let l=()=>{o.toDataURL().then((t=>{uni.$uniQuery.saveAlbum(t).then((()=>{uni.showModal({title:"温馨提示",content:"保存图片到相册成功",showCancel:!1})})).catch((t=>{console.error(t),uni.showModal({title:"温馨提示",content:"保存图片到相册失败",showCancel:!1})}))}))};return(n,o)=>{const c=g,u=h;return t(),i(u,{class:"example-container"},{default:e((()=>[r(V,{region:!1,ref_key:"mycanvasRef",ref:_,width:p(s),height:p(a)},null,8,["width","height"]),r(c,{class:"example-btnbottom",type:"primary",onClick:p(l)},{default:e((()=>[f("保存")])),_:1},8,["onClick"])])),_:1})}}}),[["__scopeId","data-v-ec37c817"]]);export{S as default};
